<!--
//http://webcomponents.github.io/articles/web-components-best-practices/
-->
<!--
/**
 * @module aha-table
 *
 *
 * Searchable Sortable Editable Paginatable Data Table
 *
 * aha-table is an data table/grid, it cousumes a modal data
 * and modal meta to show a table that can search, sort, edit
 * in place and pagiation, click to edit.
 * 
 * Examples:
 *
 *     <aha-table></aha-table>
 *
 *     <aha-table id="raw" 
 *         selectable="true" 
 *         copyable="true"
 *         seachable="true"
 *         pagesize="20" 
 *         pagesizetitle="Page Size:" 
 *         summarytitle="Viewing">
 *         <aha-column name="title" 
 *             type="string" 
 *             label="My Title"
 *             sortable="true"
 *             searchable="true"
 *             required="true"
 *             editable="false"
 *             placeholder="" 
 *             default="" 
 *             hint="Meaning title will help you remember">
 *         </aha-column>
 *     </aha-table/>
 *
 * Available Event Hander:
 *     after-invalid(Object detail)
 *     after-td-click(Object detail)
 *     after-td-dbclick(Object detail)
 *     after-create(Object new_record)
 *     after-copy(Object new_record)
 *     after-remove(Object removed_record)
 *
 * @class aha-table
 * @author Louis Liu<louis.wenchao.liu@gmail.com>
 *
 */
-->

<link rel="import" href="../../../packages/polymer/polymer.html">

<polymer-element name="aha-table" attributes="
selectable 
searchable 
copyable 
removable
pagesize 
sizelist
selecttitle 
selectalltitle 
sorttitle 
columntitle 
copytitle 
removetitle 
edittitle 
searchtitle 
firsttitle
nexttitle 
previoustitle 
lasttitle
pagetext 
pageoftext 
pagesizetext 
summarytext 
itemoftext
">
  <template>
    <style>
      /* styles for the custom element itself - lowest specificity */
      :host { 
        display: block;
      }
      
      #aha_table_main {
        border: black solid thin;
      }
      
      #aha_table_main td, #aha_table_main th {
        border: black solid thin;
      }
      
      .rows:hover, 
      .selected {
        background-color: #f3f3f3;
      }
      .column-head {
        white-space: nowrap;
      }
      .sorting {
        display: inline-block;
      }
      .sortable .column-head,
      .filterrow {
        cursor: pointer;
      }
      .sortable .column-head:hover {
        text-decoration: underline;
      }
      .arrow-up,
      .arrow-down,
      .search,
      .nosearch {
        width: 0; 
        height: 0; 
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
      }
      .arrow-up,
      .search {
        border-bottom: 5px solid black;
      }
      .arrow-down,
      .nosearch {
        border-top: 5px solid black;
      }
      .copy-er, 
      .remove-er {
        cursor: pointer;
      }
      .copy-er i:before{
        content: '+';
      }
      .remove-er i:before {
        content: '-';
      }
      .hint:before {
        content: 'i';
      }
      .searchable input, 
      .searchable select {
        width: 80px;
      }
      .pagination .active {
        background-color: #ccc;
      }
      .pagination .available:hover {
        background-color: #eee;
      }
      .pagination .disabled {
        color: #ccc;
      }
      .pagination button+button {
        margin-left: -10px;
      }
      .pagination button {
        background-color: #fff;
        border: 1px solid #eee;
        cursor: pointer;
        user-select: none;
      }
      .pagination input {
        background-color: #fff;
        border: 1px solid #eee;
        width: 20px;
      }
      .hide {
        display: none !important;
      }
      .empty {
        font-style: italic;
        color: #999;
      }
    </style>
    <table id="aha_table_main" unresolved="">
      <thead>
        <tr>
          <th>
            <input type="checkbox" 
              on-change="{{ selectall }}"
              title="{{ selectalltitle }}"
              class="{{ selectable ? '' : 'hide'}}"/>
            <div
              title="{{searchtitle}}"
              class="filterrow {{ searchable ? 'search' : 'nosearch'}}"
              on-click="{{ toggleFilters }}"></div>
          </th>
          <th template 
            repeat="{{ column in children }}"
            title="{{ columntitle }}"
            class="{{ column.sortable ? 'sortable' : ''}} aha-{{column.name}}-th">
            <span class="
               {{ sortedColumn == column.name ? 'sorting ' : 'hide'}} 
               {{ descending ? 'arrow-down' : 'arrow-up'}}"> 
            </span>
            <span 
              class="column-head" 
              title="{{sorttitle}}"
              on-click="{{ handleSort }}">{{ column.label != null ? column.label : column.name | capitalize }}</span>
            <span 
              class="{{ column.hint != null ? 'hint' : 'hide' }}" 
              title="{{ column.hint }}"></span>
          </th>
        </tr>
        <tr hidden?="{{ !searchable }}">
          <th></th>
          <th template repeat="{{ column in children }}" class="searchable">
              <template if="{{ 'choice' == column.type }}">
                <select on-change="{{ search }}" >
                    <option selected="{{searchMap[column.name] == null ? 'selected' : '' }}"></option>
                    <option template 
                      repeat="{{ option in column.options }}"
                      value="{{ option['value'] }}">
                      {{ option['label'] }}
                    </option>
                </select>
              </template>
              <template if="{{ 'boolean' == column.type }}">
                <input 
                  type="checkbox" 
                  on-change="{{ search }}" 
                  checked="{{searchMap[column.name] != null ? 'checked' : '' }}"/>
              </template>
              <template if="{{ 'choice' != column.type && 'boolean' != column.type }}">
                <input type="text" 
                  on-keyup="{{ search }}" 
                  placeholder="{{ column.searchplaceholder }}" 
                  value="{{searchMap[column.name]}}"/>
              </template>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr template
          repeat="{{ row in viewingRows }}"
          class="rows
             {{ row['_modified'] ? 'modified' : '' }}
             {{ row['_editing']  ? 'editing'  : '' }}
             {{ row['_selected'] ? 'selected'  : '' }}
           ">
          <td>
            <input type="checkbox" 
              title="{{ selecttitle }}"
              class="{{ selectable ? '' : 'hide'}}" 
              on-change="{{ select }}" 
              checked?="{{ row['_selected'] }}"/>
            <a class="copy-er {{ copyable ? '' : 'hide' }}" 
              on-click="{{copy}}" 
              title="{{ copytitle }}">
              <i></i>
            </a>
            <a class="remove-er {{ removable ? '' : 'hide' }}" 
              on-click="{{remove}}" 
              title="{{ removetitle }}">
              <i></i>
            </a>
          </td>
          <td template
            repeat="{{ column in children }}" 
            on-dblclick="{{ dbclick }}" 
            on-click="{{ click }}" 
            title="{{ column.attributes['editable'] ? edittitle: '' }}" 
            class="aha-td aha-{{column.attributes['name']}}-td">
<!--             <div class="{{ column.attributes['editable'] && row._editing ? '' : 'hide'}}"> -->
<!--               <select  -->
<!--                 required?="{{ column.attributes['required'] }}" -->
<!--                 class="{{ 'choice' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-change="{{ save }}"  -->
<!--                 on-blur="{{ save }}"> -->
<!--                 <option template -->
<!--                   repeat="{{ option in column.attributes['options'] }}" -->
<!--                   value="{{ option.value }}"  -->
<!--                   selected?="{{ row[column.attributes['name']] == option.value }}"> -->
<!--                   {{ option.label }} -->
<!--                 </option> -->
<!--               </select> -->
<!--               <input type="text"  -->
<!--                 required?="{{ column.attributes['required'] }}" -->
<!--                 class="{{ 'string' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-blur="{{ save }}"  -->
<!--                 value="{{ row[column.attributes['name']] }}"/> -->
<!--               <input type="date"  -->
<!--                 required?="{{ column.attributes['required'] }}" -->
<!--                 class="{{ 'date' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-blur="{{ save }}"  -->
<!--                 value="{{ row[column.attributes['name']] }}"/> -->
<!--               <input type="time"  -->
<!--                 required?="{{ column.attributes['required'] }}" -->
<!--                 class="{{ 'time' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-blur="{{ save }}"  -->
<!--                 value="{{ row[column.attributes['name']] }}"/> -->
<!--               <input type="datetime"  -->
<!--                 required?="{{ column.attributes['required'] }}" -->
<!--                 class="{{ 'datetime' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-blur="{{ save }}"  -->
<!--                 value="{{ row[column.attributes['name']] }}"/> -->
<!--               <textarea -->
<!--                 required?="{{ column.attributes['required'] }}" -->
<!--                 class="{{ 'text' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-mouseover="{{ focus }}" -->
<!--                 on-blur="{{ save }}">{{ row[column.attributes['name']] }}</textarea> -->
<!--               <input type="checkbox" -->
<!--                 class="{{ 'boolean' == column.attributes['type'] ? '' : 'hide'}}" -->
<!--                 on-change="{{ save }}"  -->
<!--                 checked?="{{ row[column.attributes['name']] }}" /> -->
<!--             </div> -->
            <div class="{{ column.editable && row['_editing'] ? 'hide' : ''}} {{ row[column.name] == null ? 'empty' : ''}}">
<!--               {{ translate2(row[column.name], column.options, column.placeholder) }} -->
              {{ row[column.name] }}
            </div>
          </td>
        </tr>
      </tbody>
<!--       <tfoot> -->
<!--         <tr> -->
<!--           <td colspan="{{meta.length+1}}"> -->
<!--             <div class="pagination"> -->
<!--             <span class="paging"> -->
<!--               <button -->
<!--                 title="{{firsttitle}}" -->
<!--                 class='first {{currentpage == 1 ? "disabled" : "available"}} ' -->
<!--                 on-click="{{firstPage}}">{{first}}</button> -->
<!--               <button -->
<!--                 title="{{previoustitle}}" -->
<!--                 class='previous {{currentpage == 1 ? "disabled" : "available"}}' -->
<!--                 on-click="{{prevPage}}">{{previous}}</button> -->
<!--               <span class="pager"> -->
<!--                 {{pagetext != null ? pagetext ''}} -->
<!--                 <input type="text" value="{{currentpage}}"/> -->
<!--                 {{pageoftext || '/'}} -->
<!--                 {{pageCount}} -->
<!--               </span> -->
<!--               <button -->
<!--                 title="{{nexttitle}}" -->
<!--                 class='next {{pageCount <= 0 || currentpage == pageCount? "disabled" : "available"}}' -->
<!--                 on-click="{{nextPage}}">{{next}}</button> -->
<!--               <button -->
<!--                 title="{{lasttitle}}" -->
<!--                 class='last {{pageCount <= 0 || currentpage == pageCount? "disabled" : "available"}}' -->
<!--                 on-click="{{lastPage}}">{{last}}</button> -->
<!--             </span> -->
<!--             <span class="pagesize"> -->
<!--               {{ pagesizetext || '' }} -->
<!--               <select value="{{pagesize}}"> -->
<!--                 <option template repeat="{{n in sizelist}}" selected?="{{ n == pagesize }}">{{n}}</option> -->
<!--               </select> -->
<!--             </span> -->
<!--             <span class="summary"> -->
<!--               {{ summarytext || ''}} {{ firstItemIndex }} - {{ lastItemIndex }} {{ itemoftext || '/'}} {{ itemCount }} -->
<!--             </span> -->
<!--             </div> -->
<!--           </td> -->
<!--         </tr> -->
<!--       </tfoot> -->
    </table>
  </template>
  <script type="application/dart" src="aha_table.dart"></script>
</polymer-element>

